var Orb;
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it uses a non-standard name for the exports (exports).
(() => {
var exports = __webpack_exports__;
/*!********************!*\
  !*** ./src/orb.ts ***!
  \********************/

Object.defineProperty(exports, "__esModule", ({ value: true }));
;
;
class CelestialObject {
    radius;
    max_tail_length;
    color;
    curr_tail_length = 0;
    getPosition;
}
const SUN_RADIUS = 200;
class Sun extends CelestialObject {
    radius = SUN_RADIUS / 10;
    max_tail_length = 200;
    color = "orange";
    getPosition = (_) => {
        return { r: 0, theta: 0 };
    };
}
;
/**
 *
Mercury: 57.9 million kilometers
Venus: 108.2 million kilometers
Earth: 149.6 million kilometers
Mars: 227.9 million kilometers
Jupiter: 778.3 million kilometers
Saturn: 1.43 billion kilometers
Uranus: 2.87 billion kilometers
Neptune: 4.5 billion kilometers
 *
 */
const EARTH_YEAR = 1 / 1000;
class Mercury extends CelestialObject {
    radius = 5;
    max_tail_length = 160;
    color = "red";
    getPosition = (t) => {
        return { r: SUN_RADIUS + 57.9, theta: t * 3 * EARTH_YEAR };
    };
}
;
class Venus extends CelestialObject {
    radius = 6;
    max_tail_length = 200;
    color = "grey";
    getPosition = (t) => {
        return {
            // r: SUN_RADIUS + 108.2,
            r: SUN_RADIUS + 120,
            theta: t * 2 * EARTH_YEAR
        };
    };
}
;
class Earth extends CelestialObject {
    radius = 8;
    max_tail_length = 400;
    color = "blue";
    getPosition = (t) => {
        return {
            // r: SUN_RADIUS + 149.6,
            r: SUN_RADIUS + 225,
            theta: t * EARTH_YEAR
        };
    };
}
;
class Mars extends CelestialObject {
    radius = 9;
    max_tail_length = 850;
    color = "red";
    getPosition = (t) => {
        return {
            // r: SUN_RADIUS + 227.9,
            r: SUN_RADIUS + 350,
            theta: t * 0.75 * EARTH_YEAR
        };
    };
}
;
class Jupiter extends CelestialObject {
    radius = 12;
    max_tail_length = 1000;
    color = "orange";
    getPosition = (t) => {
        return {
            // r: SUN_RADIUS + 778.3,
            r: SUN_RADIUS + 550,
            theta: t * 0.5 * EARTH_YEAR
        };
    };
}
;
class Saturn extends CelestialObject {
    radius = 13;
    max_tail_length = 1500;
    color = "orange";
    getPosition = (t) => {
        return {
            // r: SUN_RADIUS + 1430,
            r: SUN_RADIUS + 750,
            theta: t * 0.25 * EARTH_YEAR
        };
    };
}
;
class Uranus extends CelestialObject {
    radius = 8;
    max_tail_length = 3000;
    color = "blue";
    getPosition = (t) => {
        return {
            // r: SUN_RADIUS + 2870,
            r: SUN_RADIUS + 950,
            theta: t * 0.125 * EARTH_YEAR
        };
    };
}
;
class Neptune extends CelestialObject {
    radius = 7;
    max_tail_length = 5250;
    color = "blue";
    getPosition = (t) => {
        return {
            // r: SUN_RADIUS + 4500,
            r: SUN_RADIUS + 1200,
            theta: t * 0.08 * EARTH_YEAR
        };
    };
}
;
const PREVIOUS_POS_LENGTH = 100000;
class Orb {
    canvas;
    ctx;
    // Celestial objects in radial coordinates relative to the Sun
    celestialObjects;
    reference_id = 0;
    ref_translation = 1;
    next_reference = 0;
    ref_modified_ts = 0;
    prevPositions;
    origins;
    timestamps;
    constructor(canvas) {
        this.canvas = canvas;
        this.celestialObjects = [];
        this.celestialObjects.push(new Sun());
        this.celestialObjects.push(new Mercury());
        this.celestialObjects.push(new Venus());
        this.celestialObjects.push(new Earth());
        this.celestialObjects.push(new Mars());
        this.celestialObjects.push(new Jupiter());
        this.celestialObjects.push(new Saturn());
        this.celestialObjects.push(new Uranus());
        this.celestialObjects.push(new Neptune());
        this.canvas.width = 1000;
        this.canvas.height = 1000;
        console.log(this.canvas.width, 'x', this.canvas.height);
        this.ctx = this.canvas.getContext("2d");
        this.prevPositions = new Map();
        for (let obj of this.celestialObjects) {
            const name = obj.constructor.name;
            this.prevPositions.set(name, []);
        }
        this.origins = [];
        this.timestamps = [];
    }
    set_reference(n) {
        if (n >= 0 && n < this.celestialObjects.length) {
            this.next_reference = n;
            this.ref_translation = 0;
        }
    }
    toCPoint(pos) {
        return {
            x: (pos.r / 4) * Math.cos(pos.theta),
            y: (pos.r / 4) * Math.sin(pos.theta),
        };
    }
    draw(t) {
        // t = 0;
        // this.ctx.fillStyle = "black";
        // this.ctx.beginPath();
        // this.ctx.rect(0, 0, this.canvas.width, this.canvas.height);
        // this.ctx.fill();
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        // console.log("Draw", t);
        // Get the location from the reference
        let ref = this.celestialObjects[this.reference_id];
        let p = this.toCPoint(ref.getPosition(t));
        let ox = p.x;
        let oy = p.y;
        if (this.ref_translation != 1) {
            // Get the location from the next reference
            let nref = this.celestialObjects[this.next_reference];
            let n = this.toCPoint(nref.getPosition(t));
            ox = p.x * (1 - this.ref_translation) + n.x * this.ref_translation;
            oy = p.y * (1 - this.ref_translation) + n.y * this.ref_translation;
            this.ref_translation += 1 / 250;
            if (this.ref_translation >= 1) {
                this.ref_translation = 1;
                this.reference_id = this.next_reference;
                this.ref_modified_ts = t;
            }
        }
        let origin = { x: ox, y: oy };
        const sunRPointToScreenCoords = (pos, origin) => {
            const p = this.toCPoint(pos);
            // Translate to the reference's relative coords
            p.x -= origin.x;
            p.y -= origin.y;
            // Convert to screen coords
            p.x += this.canvas.width / 2;
            p.y += this.canvas.height / 2;
            return p;
        };
        // Draw tails
        for (let ci = 0; ci < this.celestialObjects.length; ci++) {
            const obj = this.celestialObjects[ci];
            // if (ci == this.reference_id && this.ref_translation == 1) {
            //   continue;
            // }
            this.ctx.strokeStyle = obj.color;
            const name = obj.constructor.name;
            const points = this.prevPositions.get(name);
            if (points.length <= 1) {
                continue;
            }
            let coords = sunRPointToScreenCoords(points[points.length - 1], 
            // origin
            this.origins[points.length - 1]);
            let last_ts = this.timestamps[points.length - 1];
            let prev_x = coords.x;
            let prev_y = coords.y;
            let start_x = coords.x;
            let start_y = coords.y;
            let i = 2;
            //this.ctx.beginPath();
            //this.ctx.moveTo(prev_x, prev_y);
            //for (; i <= points.length; i++) {
            //  coords = sunRPointToScreenCoords(
            //    points[points.length - i],
            //    this.origins[points.length - i],
            //    // this.toCPoint(ref_pos[points.length - 1])
            //  );
            //  let x = coords.x;
            //  let y = coords.y;
            //  this.ctx.lineTo(x, y);
            //  prev_x = x;
            //  prev_y = y;
            //}
            //this.ctx.stroke();
            this.ctx.beginPath();
            this.ctx.moveTo(prev_x, prev_y);
            for (let i = 2; i <= Math.min(points.length, obj.curr_tail_length); i++) {
                coords = sunRPointToScreenCoords(points[points.length - i], this.origins[points.length - i]);
                last_ts = this.timestamps[points.length - i];
                let x = coords.x;
                let y = coords.y;
                this.ctx.lineTo(x, y);
                prev_x = x;
                prev_y = y;
            }
            this.ctx.stroke();
            if (last_ts < this.ref_modified_ts && obj.curr_tail_length > 1) {
                obj.curr_tail_length -= 1;
            }
            else if (obj.curr_tail_length < obj.max_tail_length) {
                obj.curr_tail_length += 1;
            }
        }
        // Draw planets
        for (let obj of this.celestialObjects) {
            const name = obj.constructor.name;
            let pos = obj.getPosition(t);
            pos.theta %= (2 * Math.PI);
            if (this.prevPositions.get(name).length >= PREVIOUS_POS_LENGTH) {
                this.prevPositions.get(name).shift();
            }
            this.prevPositions.get(name).push(pos);
            let coords = sunRPointToScreenCoords(pos, origin);
            let x = coords.x;
            let y = coords.y;
            this.ctx.fillStyle = "white";
            this.ctx.beginPath();
            this.ctx.arc(x, y, obj.radius + 5, 0, 2 * Math.PI);
            this.ctx.fill();
            this.ctx.fillStyle = obj.color;
            this.ctx.beginPath();
            this.ctx.arc(x, y, obj.radius, 0, 2 * Math.PI);
            this.ctx.fill();
            this.ctx.font = `${obj.radius}px Serif`;
            this.ctx.fillStyle = "black";
            const label = name[0];
            const size = this.ctx.measureText(label);
            this.ctx.fillText(label, x - size.width / 2, y + obj.radius / 4);
        }
        if (this.origins.length >= PREVIOUS_POS_LENGTH) {
            this.origins.shift();
            this.timestamps.shift();
        }
        this.origins.push(origin);
        this.timestamps.push(t);
    }
}
exports["default"] = Orb;

})();

Orb = __webpack_exports__["default"];
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RCx5QkF3TkMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9PcmIvLi9zcmMvb3JiLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImludGVyZmFjZSBSUG9pbnQge1xuICByOiBudW1iZXI7XG4gIHRoZXRhOiBudW1iZXI7XG59O1xuXG5pbnRlcmZhY2UgQ1BvaW50IHtcbiAgeDogbnVtYmVyO1xuICB5OiBudW1iZXI7XG59O1xuXG5jbGFzcyBDZWxlc3RpYWxPYmplY3Qge1xuICByYWRpdXM6IG51bWJlcjtcbiAgbWF4X3RhaWxfbGVuZ3RoOiBudW1iZXI7XG4gIGNvbG9yOiBzdHJpbmc7XG5cbiAgY3Vycl90YWlsX2xlbmd0aDogbnVtYmVyID0gMDtcblxuICBnZXRQb3NpdGlvbjogKHQ6IG51bWJlcikgPT4gUlBvaW50O1xufVxuXG5jb25zdCBTVU5fUkFESVVTID0gMjAwO1xuY2xhc3MgU3VuIGV4dGVuZHMgQ2VsZXN0aWFsT2JqZWN0IHtcbiAgcmVhZG9ubHkgcmFkaXVzID0gU1VOX1JBRElVUyAvIDEwO1xuICByZWFkb25seSBtYXhfdGFpbF9sZW5ndGggPSAyMDA7XG4gIHJlYWRvbmx5IGNvbG9yID0gXCJvcmFuZ2VcIjtcblxuICBnZXRQb3NpdGlvbiA9IChfOiBudW1iZXIpOiBSUG9pbnQgPT4ge1xuICAgIHJldHVybiB7IHI6IDAsIHRoZXRhOiAwIH07XG4gIH1cbn07XG5cbi8qKlxuICpcbk1lcmN1cnk6IDU3LjkgbWlsbGlvbiBraWxvbWV0ZXJzXG5WZW51czogMTA4LjIgbWlsbGlvbiBraWxvbWV0ZXJzXG5FYXJ0aDogMTQ5LjYgbWlsbGlvbiBraWxvbWV0ZXJzXG5NYXJzOiAyMjcuOSBtaWxsaW9uIGtpbG9tZXRlcnNcbkp1cGl0ZXI6IDc3OC4zIG1pbGxpb24ga2lsb21ldGVyc1xuU2F0dXJuOiAxLjQzIGJpbGxpb24ga2lsb21ldGVyc1xuVXJhbnVzOiAyLjg3IGJpbGxpb24ga2lsb21ldGVyc1xuTmVwdHVuZTogNC41IGJpbGxpb24ga2lsb21ldGVyc1xuICpcbiAqL1xuXG5jb25zdCBFQVJUSF9ZRUFSID0gMSAvIDEwMDA7XG5cbmNsYXNzIE1lcmN1cnkgZXh0ZW5kcyBDZWxlc3RpYWxPYmplY3Qge1xuICByZWFkb25seSByYWRpdXMgPSA1O1xuICByZWFkb25seSBtYXhfdGFpbF9sZW5ndGggPSAxNjA7XG4gIHJlYWRvbmx5IGNvbG9yID0gXCJyZWRcIjtcblxuICBnZXRQb3NpdGlvbiA9ICh0OiBudW1iZXIpOiBSUG9pbnQgPT4ge1xuICAgIHJldHVybiB7IHI6IFNVTl9SQURJVVMgKyA1Ny45LCB0aGV0YTogdCAqIDMgKiBFQVJUSF9ZRUFSIH07XG4gIH1cbn07XG5cbmNsYXNzIFZlbnVzIGV4dGVuZHMgQ2VsZXN0aWFsT2JqZWN0IHtcbiAgcmVhZG9ubHkgcmFkaXVzID0gNjtcbiAgcmVhZG9ubHkgbWF4X3RhaWxfbGVuZ3RoID0gMjAwO1xuICByZWFkb25seSBjb2xvciA9IFwiZ3JleVwiO1xuXG4gIGdldFBvc2l0aW9uID0gKHQ6IG51bWJlcik6IFJQb2ludCA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIHI6IFNVTl9SQURJVVMgKyAxMDguMixcbiAgICAgIHI6IFNVTl9SQURJVVMgKyAxMjAsXG4gICAgICB0aGV0YTogdCAqIDIgKiBFQVJUSF9ZRUFSXG4gICAgfTtcbiAgfVxufTtcblxuXG5jbGFzcyBFYXJ0aCBleHRlbmRzIENlbGVzdGlhbE9iamVjdCB7XG4gIHJlYWRvbmx5IHJhZGl1cyA9IDg7XG4gIHJlYWRvbmx5IG1heF90YWlsX2xlbmd0aCA9IDQwMDtcbiAgcmVhZG9ubHkgY29sb3IgPSBcImJsdWVcIjtcblxuICBnZXRQb3NpdGlvbiA9ICh0OiBudW1iZXIpOiBSUG9pbnQgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICAvLyByOiBTVU5fUkFESVVTICsgMTQ5LjYsXG4gICAgICByOiBTVU5fUkFESVVTICsgMjI1LFxuICAgICAgdGhldGE6IHQgKiBFQVJUSF9ZRUFSXG4gICAgfTtcbiAgfVxufTtcblxuY2xhc3MgTWFycyBleHRlbmRzIENlbGVzdGlhbE9iamVjdCB7XG4gIHJlYWRvbmx5IHJhZGl1cyA9IDk7XG4gIHJlYWRvbmx5IG1heF90YWlsX2xlbmd0aCA9IDg1MDtcbiAgcmVhZG9ubHkgY29sb3IgPSBcInJlZFwiO1xuXG4gIGdldFBvc2l0aW9uID0gKHQ6IG51bWJlcik6IFJQb2ludCA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIHI6IFNVTl9SQURJVVMgKyAyMjcuOSxcbiAgICAgIHI6IFNVTl9SQURJVVMgKyAzNTAsXG4gICAgICB0aGV0YTogdCAqIDAuNzUgKiBFQVJUSF9ZRUFSXG4gICAgfTtcbiAgfVxufTtcblxuY2xhc3MgSnVwaXRlciBleHRlbmRzIENlbGVzdGlhbE9iamVjdCB7XG4gIHJlYWRvbmx5IHJhZGl1cyA9IDEyO1xuICByZWFkb25seSBtYXhfdGFpbF9sZW5ndGggPSAxMDAwO1xuICByZWFkb25seSBjb2xvciA9IFwib3JhbmdlXCI7XG5cbiAgZ2V0UG9zaXRpb24gPSAodDogbnVtYmVyKTogUlBvaW50ID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgLy8gcjogU1VOX1JBRElVUyArIDc3OC4zLFxuICAgICAgcjogU1VOX1JBRElVUyArIDU1MCxcbiAgICAgIHRoZXRhOiB0ICogMC41ICogRUFSVEhfWUVBUlxuICAgIH07XG4gIH1cbn07XG5cbmNsYXNzIFNhdHVybiBleHRlbmRzIENlbGVzdGlhbE9iamVjdCB7XG4gIHJlYWRvbmx5IHJhZGl1cyA9IDEzO1xuICByZWFkb25seSBtYXhfdGFpbF9sZW5ndGggPSAxNTAwO1xuICByZWFkb25seSBjb2xvciA9IFwib3JhbmdlXCI7XG5cbiAgZ2V0UG9zaXRpb24gPSAodDogbnVtYmVyKTogUlBvaW50ID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgLy8gcjogU1VOX1JBRElVUyArIDE0MzAsXG4gICAgICByOiBTVU5fUkFESVVTICsgNzUwLFxuICAgICAgdGhldGE6IHQgKiAwLjI1ICogRUFSVEhfWUVBUlxuICAgIH07XG4gIH1cbn07XG5cbmNsYXNzIFVyYW51cyBleHRlbmRzIENlbGVzdGlhbE9iamVjdCB7XG4gIHJlYWRvbmx5IHJhZGl1cyA9IDg7XG4gIHJlYWRvbmx5IG1heF90YWlsX2xlbmd0aCA9IDMwMDA7XG4gIHJlYWRvbmx5IGNvbG9yID0gXCJibHVlXCI7XG5cbiAgZ2V0UG9zaXRpb24gPSAodDogbnVtYmVyKTogUlBvaW50ID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgLy8gcjogU1VOX1JBRElVUyArIDI4NzAsXG4gICAgICByOiBTVU5fUkFESVVTICsgOTUwLFxuICAgICAgdGhldGE6IHQgKiAwLjEyNSAqIEVBUlRIX1lFQVJcbiAgICB9O1xuICB9XG59O1xuXG5jbGFzcyBOZXB0dW5lIGV4dGVuZHMgQ2VsZXN0aWFsT2JqZWN0IHtcbiAgcmVhZG9ubHkgcmFkaXVzID0gNztcbiAgcmVhZG9ubHkgbWF4X3RhaWxfbGVuZ3RoID0gNTI1MDtcbiAgcmVhZG9ubHkgY29sb3IgPSBcImJsdWVcIjtcblxuICBnZXRQb3NpdGlvbiA9ICh0OiBudW1iZXIpOiBSUG9pbnQgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICAvLyByOiBTVU5fUkFESVVTICsgNDUwMCxcbiAgICAgIHI6IFNVTl9SQURJVVMgKyAxMjAwLFxuICAgICAgdGhldGE6IHQgKiAwLjA4ICogRUFSVEhfWUVBUlxuICAgIH07XG4gIH1cbn07XG5cbmNvbnN0IFBSRVZJT1VTX1BPU19MRU5HVEggPSAxMDAwMDA7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9yYiB7XG4gIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG4gIGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuXG4gIC8vIENlbGVzdGlhbCBvYmplY3RzIGluIHJhZGlhbCBjb29yZGluYXRlcyByZWxhdGl2ZSB0byB0aGUgU3VuXG4gIGNlbGVzdGlhbE9iamVjdHM6IENlbGVzdGlhbE9iamVjdFtdO1xuXG4gIHJlZmVyZW5jZV9pZDogbnVtYmVyID0gMDtcbiAgcmVmX3RyYW5zbGF0aW9uOiBudW1iZXIgPSAxO1xuICBuZXh0X3JlZmVyZW5jZTogbnVtYmVyID0gMDtcbiAgcmVmX21vZGlmaWVkX3RzOiBudW1iZXIgPSAwO1xuXG4gIHByZXZQb3NpdGlvbnM6IE1hcDxTdHJpbmcsIFJQb2ludFtdPjtcbiAgb3JpZ2luczogQ1BvaW50W107XG4gIHRpbWVzdGFtcHM6IG51bWJlcltdO1xuXG4gIGNvbnN0cnVjdG9yKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpIHtcbiAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcbiAgICB0aGlzLmNlbGVzdGlhbE9iamVjdHMgPSBbXTtcbiAgICB0aGlzLmNlbGVzdGlhbE9iamVjdHMucHVzaChuZXcgU3VuKCkpO1xuICAgIHRoaXMuY2VsZXN0aWFsT2JqZWN0cy5wdXNoKG5ldyBNZXJjdXJ5KCkpO1xuICAgIHRoaXMuY2VsZXN0aWFsT2JqZWN0cy5wdXNoKG5ldyBWZW51cygpKTtcbiAgICB0aGlzLmNlbGVzdGlhbE9iamVjdHMucHVzaChuZXcgRWFydGgoKSk7XG4gICAgdGhpcy5jZWxlc3RpYWxPYmplY3RzLnB1c2gobmV3IE1hcnMoKSk7XG4gICAgdGhpcy5jZWxlc3RpYWxPYmplY3RzLnB1c2gobmV3IEp1cGl0ZXIoKSk7XG4gICAgdGhpcy5jZWxlc3RpYWxPYmplY3RzLnB1c2gobmV3IFNhdHVybigpKTtcbiAgICB0aGlzLmNlbGVzdGlhbE9iamVjdHMucHVzaChuZXcgVXJhbnVzKCkpO1xuICAgIHRoaXMuY2VsZXN0aWFsT2JqZWN0cy5wdXNoKG5ldyBOZXB0dW5lKCkpO1xuXG4gICAgdGhpcy5jYW52YXMud2lkdGggPSAxMDAwO1xuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IDEwMDA7XG4gICAgY29uc29sZS5sb2codGhpcy5jYW52YXMud2lkdGgsICd4JywgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSE7XG5cbiAgICB0aGlzLnByZXZQb3NpdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgZm9yIChsZXQgb2JqIG9mIHRoaXMuY2VsZXN0aWFsT2JqZWN0cykge1xuICAgICAgY29uc3QgbmFtZSA9IG9iai5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgdGhpcy5wcmV2UG9zaXRpb25zLnNldChuYW1lLCBbXSk7XG4gICAgfVxuXG4gICAgdGhpcy5vcmlnaW5zID0gW107XG4gICAgdGhpcy50aW1lc3RhbXBzID0gW107XG4gIH1cblxuXG4gIHNldF9yZWZlcmVuY2UobjogbnVtYmVyKSB7XG4gICAgaWYgKG4gPj0gMCAmJiBuIDwgdGhpcy5jZWxlc3RpYWxPYmplY3RzLmxlbmd0aCkge1xuICAgICAgdGhpcy5uZXh0X3JlZmVyZW5jZSA9IG47XG4gICAgICB0aGlzLnJlZl90cmFuc2xhdGlvbiA9IDA7XG4gICAgfVxuICB9XG5cbiAgdG9DUG9pbnQocG9zOiBSUG9pbnQpOiBDUG9pbnQge1xuICAgIHJldHVybiB7XG4gICAgICB4OiAocG9zLnIgLyA0KSAqIE1hdGguY29zKHBvcy50aGV0YSksXG4gICAgICB5OiAocG9zLnIgLyA0KSAqIE1hdGguc2luKHBvcy50aGV0YSksXG4gICAgfVxuICB9XG5cbiAgZHJhdyh0OiBudW1iZXIpIHtcbiAgICAvLyB0ID0gMDtcbiAgICAvLyB0aGlzLmN0eC5maWxsU3R5bGUgPSBcImJsYWNrXCI7XG4gICAgLy8gdGhpcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgLy8gdGhpcy5jdHgucmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICAvLyB0aGlzLmN0eC5maWxsKCk7XG4gICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiRHJhd1wiLCB0KTtcbiAgICAvLyBHZXQgdGhlIGxvY2F0aW9uIGZyb20gdGhlIHJlZmVyZW5jZVxuICAgIGxldCByZWYgPSB0aGlzLmNlbGVzdGlhbE9iamVjdHNbdGhpcy5yZWZlcmVuY2VfaWRdO1xuICAgIGxldCBwID0gdGhpcy50b0NQb2ludChyZWYuZ2V0UG9zaXRpb24odCkpO1xuXG4gICAgbGV0IG94ID0gcC54O1xuICAgIGxldCBveSA9IHAueTtcbiAgICBpZiAodGhpcy5yZWZfdHJhbnNsYXRpb24gIT0gMSkge1xuICAgICAgLy8gR2V0IHRoZSBsb2NhdGlvbiBmcm9tIHRoZSBuZXh0IHJlZmVyZW5jZVxuICAgICAgbGV0IG5yZWYgPSB0aGlzLmNlbGVzdGlhbE9iamVjdHNbdGhpcy5uZXh0X3JlZmVyZW5jZV07XG4gICAgICBsZXQgbiA9IHRoaXMudG9DUG9pbnQobnJlZi5nZXRQb3NpdGlvbih0KSk7XG5cbiAgICAgIG94ID0gcC54ICogKDEgLSB0aGlzLnJlZl90cmFuc2xhdGlvbikgKyBuLnggKiB0aGlzLnJlZl90cmFuc2xhdGlvbjtcbiAgICAgIG95ID0gcC55ICogKDEgLSB0aGlzLnJlZl90cmFuc2xhdGlvbikgKyBuLnkgKiB0aGlzLnJlZl90cmFuc2xhdGlvbjtcblxuICAgICAgdGhpcy5yZWZfdHJhbnNsYXRpb24gKz0gMSAvIDI1MDtcbiAgICAgIGlmICh0aGlzLnJlZl90cmFuc2xhdGlvbiA+PSAxKSB7XG4gICAgICAgIHRoaXMucmVmX3RyYW5zbGF0aW9uID0gMTtcbiAgICAgICAgdGhpcy5yZWZlcmVuY2VfaWQgPSB0aGlzLm5leHRfcmVmZXJlbmNlO1xuICAgICAgICB0aGlzLnJlZl9tb2RpZmllZF90cyA9IHQ7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBvcmlnaW4gPSB7IHg6IG94LCB5OiBveSB9O1xuXG4gICAgY29uc3Qgc3VuUlBvaW50VG9TY3JlZW5Db29yZHMgPSAocG9zOiBSUG9pbnQsIG9yaWdpbjogQ1BvaW50KTogQ1BvaW50ID0+IHtcbiAgICAgIGNvbnN0IHAgPSB0aGlzLnRvQ1BvaW50KHBvcyk7XG4gICAgICAvLyBUcmFuc2xhdGUgdG8gdGhlIHJlZmVyZW5jZSdzIHJlbGF0aXZlIGNvb3Jkc1xuICAgICAgcC54IC09IG9yaWdpbi54O1xuICAgICAgcC55IC09IG9yaWdpbi55O1xuXG4gICAgICAvLyBDb252ZXJ0IHRvIHNjcmVlbiBjb29yZHNcbiAgICAgIHAueCArPSB0aGlzLmNhbnZhcy53aWR0aCAvIDI7XG4gICAgICBwLnkgKz0gdGhpcy5jYW52YXMuaGVpZ2h0IC8gMjtcblxuICAgICAgcmV0dXJuIHA7XG4gICAgfVxuXG4gICAgLy8gRHJhdyB0YWlsc1xuICAgIGZvciAobGV0IGNpID0gMDsgY2kgPCB0aGlzLmNlbGVzdGlhbE9iamVjdHMubGVuZ3RoOyBjaSsrKSB7XG4gICAgICBjb25zdCBvYmogPSB0aGlzLmNlbGVzdGlhbE9iamVjdHNbY2ldO1xuICAgICAgLy8gaWYgKGNpID09IHRoaXMucmVmZXJlbmNlX2lkICYmIHRoaXMucmVmX3RyYW5zbGF0aW9uID09IDEpIHtcbiAgICAgIC8vICAgY29udGludWU7XG4gICAgICAvLyB9XG4gICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9IG9iai5jb2xvcjtcblxuXG4gICAgICBjb25zdCBuYW1lID0gb2JqLmNvbnN0cnVjdG9yLm5hbWU7XG4gICAgICBjb25zdCBwb2ludHMgPSB0aGlzLnByZXZQb3NpdGlvbnMuZ2V0KG5hbWUpO1xuICAgICAgaWYgKHBvaW50cy5sZW5ndGggPD0gMSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgbGV0IGNvb3JkcyA9IHN1blJQb2ludFRvU2NyZWVuQ29vcmRzKFxuICAgICAgICBwb2ludHNbcG9pbnRzLmxlbmd0aCAtIDFdLFxuICAgICAgICAvLyBvcmlnaW5cbiAgICAgICAgdGhpcy5vcmlnaW5zW3BvaW50cy5sZW5ndGggLSAxXSxcbiAgICAgICAgLy8gdGhpcy50b0NQb2ludChyZWZfcG9zW3BvaW50cy5sZW5ndGggLSAxXSlcbiAgICAgICk7XG4gICAgICBsZXQgbGFzdF90cyA9IHRoaXMudGltZXN0YW1wc1twb2ludHMubGVuZ3RoIC0gMV07XG4gICAgICBsZXQgcHJldl94ID0gY29vcmRzLng7XG4gICAgICBsZXQgcHJldl95ID0gY29vcmRzLnk7XG4gICAgICBsZXQgc3RhcnRfeCA9IGNvb3Jkcy54O1xuICAgICAgbGV0IHN0YXJ0X3kgPSBjb29yZHMueTtcblxuICAgICAgbGV0IGkgPSAyO1xuXG4gICAgICAvL3RoaXMuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgLy90aGlzLmN0eC5tb3ZlVG8ocHJldl94LCBwcmV2X3kpO1xuICAgICAgLy9mb3IgKDsgaSA8PSBwb2ludHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIC8vICBjb29yZHMgPSBzdW5SUG9pbnRUb1NjcmVlbkNvb3JkcyhcbiAgICAgIC8vICAgIHBvaW50c1twb2ludHMubGVuZ3RoIC0gaV0sXG4gICAgICAvLyAgICB0aGlzLm9yaWdpbnNbcG9pbnRzLmxlbmd0aCAtIGldLFxuICAgICAgLy8gICAgLy8gdGhpcy50b0NQb2ludChyZWZfcG9zW3BvaW50cy5sZW5ndGggLSAxXSlcbiAgICAgIC8vICApO1xuICAgICAgLy8gIGxldCB4ID0gY29vcmRzLng7XG4gICAgICAvLyAgbGV0IHkgPSBjb29yZHMueTtcblxuICAgICAgLy8gIHRoaXMuY3R4LmxpbmVUbyh4LCB5KTtcblxuICAgICAgLy8gIHByZXZfeCA9IHg7XG4gICAgICAvLyAgcHJldl95ID0geTtcbiAgICAgIC8vfVxuICAgICAgLy90aGlzLmN0eC5zdHJva2UoKTtcblxuICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgICB0aGlzLmN0eC5tb3ZlVG8ocHJldl94LCBwcmV2X3kpO1xuICAgICAgZm9yIChsZXQgaSA9IDI7IGkgPD0gTWF0aC5taW4ocG9pbnRzLmxlbmd0aCwgb2JqLmN1cnJfdGFpbF9sZW5ndGgpOyBpKyspIHtcbiAgICAgICAgY29vcmRzID0gc3VuUlBvaW50VG9TY3JlZW5Db29yZHMoXG4gICAgICAgICAgcG9pbnRzW3BvaW50cy5sZW5ndGggLSBpXSxcbiAgICAgICAgICB0aGlzLm9yaWdpbnNbcG9pbnRzLmxlbmd0aCAtIGldLFxuICAgICAgICAgIC8vIHRoaXMudG9DUG9pbnQocmVmX3Bvc1twb2ludHMubGVuZ3RoIC0gMV0pXG4gICAgICAgICk7XG4gICAgICAgIGxhc3RfdHMgPSB0aGlzLnRpbWVzdGFtcHNbcG9pbnRzLmxlbmd0aCAtIGldO1xuXG4gICAgICAgIGxldCB4ID0gY29vcmRzLng7XG4gICAgICAgIGxldCB5ID0gY29vcmRzLnk7XG5cbiAgICAgICAgdGhpcy5jdHgubGluZVRvKHgsIHkpO1xuXG4gICAgICAgIHByZXZfeCA9IHg7XG4gICAgICAgIHByZXZfeSA9IHk7XG4gICAgICB9XG4gICAgICB0aGlzLmN0eC5zdHJva2UoKTtcblxuICAgICAgaWYgKGxhc3RfdHMgPCB0aGlzLnJlZl9tb2RpZmllZF90cyAmJiBvYmouY3Vycl90YWlsX2xlbmd0aCA+IDEpIHtcbiAgICAgICAgb2JqLmN1cnJfdGFpbF9sZW5ndGggLT0gMTtcbiAgICAgIH0gZWxzZSBpZiAob2JqLmN1cnJfdGFpbF9sZW5ndGggPCBvYmoubWF4X3RhaWxfbGVuZ3RoKSB7XG4gICAgICAgIG9iai5jdXJyX3RhaWxfbGVuZ3RoICs9IDE7XG4gICAgICB9XG4gICAgfVxuXG5cblxuICAgIC8vIERyYXcgcGxhbmV0c1xuICAgIGZvciAobGV0IG9iaiBvZiB0aGlzLmNlbGVzdGlhbE9iamVjdHMpIHtcbiAgICAgIGNvbnN0IG5hbWUgPSBvYmouY29uc3RydWN0b3IubmFtZTtcblxuICAgICAgbGV0IHBvcyA9IG9iai5nZXRQb3NpdGlvbih0KTtcbiAgICAgIHBvcy50aGV0YSAlPSAoMiAqIE1hdGguUEkpO1xuICAgICAgaWYgKHRoaXMucHJldlBvc2l0aW9ucy5nZXQobmFtZSkubGVuZ3RoID49IFBSRVZJT1VTX1BPU19MRU5HVEgpIHtcbiAgICAgICAgdGhpcy5wcmV2UG9zaXRpb25zLmdldChuYW1lKS5zaGlmdCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5wcmV2UG9zaXRpb25zLmdldChuYW1lKS5wdXNoKHBvcyk7XG5cbiAgICAgIGxldCBjb29yZHMgPSBzdW5SUG9pbnRUb1NjcmVlbkNvb3Jkcyhwb3MsIG9yaWdpbik7XG4gICAgICBsZXQgeCA9IGNvb3Jkcy54O1xuICAgICAgbGV0IHkgPSBjb29yZHMueTtcblxuICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgICB0aGlzLmN0eC5hcmMoeCwgeSwgb2JqLnJhZGl1cyArIDUsIDAsIDIgKiBNYXRoLlBJKTtcbiAgICAgIHRoaXMuY3R4LmZpbGwoKTtcbiAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IG9iai5jb2xvcjtcbiAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgdGhpcy5jdHguYXJjKHgsIHksIG9iai5yYWRpdXMsIDAsIDIgKiBNYXRoLlBJKTtcbiAgICAgIHRoaXMuY3R4LmZpbGwoKTtcbiAgICAgIHRoaXMuY3R4LmZvbnQgPSBgJHtvYmoucmFkaXVzfXB4IFNlcmlmYDtcbiAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IFwiYmxhY2tcIjtcbiAgICAgIGNvbnN0IGxhYmVsID0gbmFtZVswXTtcbiAgICAgIGNvbnN0IHNpemUgPSB0aGlzLmN0eC5tZWFzdXJlVGV4dChsYWJlbCk7XG4gICAgICB0aGlzLmN0eC5maWxsVGV4dChsYWJlbCwgeCAtIHNpemUud2lkdGggLyAyLCB5ICsgb2JqLnJhZGl1cyAvIDQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9yaWdpbnMubGVuZ3RoID49IFBSRVZJT1VTX1BPU19MRU5HVEgpIHtcbiAgICAgIHRoaXMub3JpZ2lucy5zaGlmdCgpO1xuICAgICAgdGhpcy50aW1lc3RhbXBzLnNoaWZ0KCk7XG4gICAgfVxuICAgIHRoaXMub3JpZ2lucy5wdXNoKG9yaWdpbik7XG4gICAgdGhpcy50aW1lc3RhbXBzLnB1c2godCk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9